<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">My Project Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_purpose"></a>
Purpose</h1>
<p>The purpose of this lab is to create a self balancing bike robot named the You're-Almost-There. Using a PID control scheme, the balancing bike was able to keep itself upright.</p>
<h1><a class="anchor" id="sec_usage"></a>
Usage</h1>
<p>The appropriate pins will need to be set up to have the system running properly The pin descriptions are outlined in the classes in the other subsections. The I2C data bus must be enabled and be able to read the digital readings from the BNO055_Base driver The following code can be directly copied and pasted into the STM32 microcontroller, with motor shield, to run the self balancing mechanism. The battery must be fully charged, and if possible have a 24V DC source for more stability. The bike must initially be as straight as possible since the IMU takes the first measurement as the reference point of the balance.</p>
<h1><a class="anchor" id="sec_test"></a>
Testing</h1>
<p>You're-Almost-There initially could not balance itself with just a proportional controller. We added in the derivative element into the control scheme, but the system still could not reliably balance. After hours of testing, we were able to find out that the derivative gain had the wrong signage and gave the wrong signals to set the duty cycle of the motor. By correcting the signage, the bike was able to balance even with disturbances. To create a quicker responding system, we added in the integral element into the control scheme as well. To find the correct gains, we set all gain to 0 and adjusted the proportional gain to create a stable oscillation near the balance reference angle. After find the proportional gain, the derivative gain was adjusted to dampen out the oscillation as much as possible. After reaching close to a critically damped response, the integral gain was adjusted to reach steady state even quicker.</p>
<h1><a class="anchor" id="sec_bug"></a>
Bugs</h1>
<p>Initially, the controller was running at such a high frequency and high priority, that it did not give the other tasks a chance to be run. We wanted to make sure the timing of the controller was at least 5~10 times faster than the time constant of the motor with the load. We fine tuned the timing frequency and the priority so that all the tasks have a chance to run. We set the ultrasonic sensor task as the highest priority for safety of the user and the bike. The ultrasonic sensor also had very buggy readings where if the readings were taken too quickly, it would pick up noise and return false values. We decided to run the ultrasonic sensor every 0.5 seconds so that the readings can be more stable. The IMU was also very buggy where the tuple returned from the function would not be stored into a variable. A 0 would be stored everytime, so we were able to mitigate that by not using a intermediate variable in the reading of the IMU. The remote sends code to the receiver in DEC protocol Due to the restrained time, the DEC protocol was not decoded so the input pin is triggered when the first 0 is read from the pin. The remote task can be unreliable due to the negligance of the DEC protocol.</p>
<h1><a class="anchor" id="sec_lim"></a>
Limitations</h1>
<p>We purposefully did not use a thicker based wheel or counter balancing weight to stabilize our system. We wanted to fully balance the robot by using reaction wheel dynamics. The robot had trouble balancing due to the lack of inertia from the reaction wheel and the torque from the motor. On 24V DC power the robot is stable and can achieve equilibrium, but the voltage rating of the motor is only 12V DC. It is possible to run the motor with 24V DC power source, but the motor heats up due to high current. In the future, a higher rate torque motor can be used to mitigate this problem. The struture of the bike also creates vibration when the reaction wheel reaches around 600 RPM. The vibration does not affect the balance immensely, but if the accelerometer readings were very crucial in future applications, the IMU would return inaccurate values.For our purposes, the system was robust enough to handle minor vibrations. The driving motor, during our rigorous tests had mechanical failure. The gear box within the DC motor experiences slippage and there are times where the gears get jammed. In that case, the motor does not spin. The user needs to firmly tap the backside of motor housing to realign the motors in the gear box. If the motor experiences extensive stress and saturates the duty cycle fluctuating between -100 and 100 constantly, there is a chance for the flange coupler to give out. The coupler is set by 4 set screws and can get loose due to the constant impulses of torque.</p>
<h1><a class="anchor" id="sec_loc"></a>
Location</h1>
<p>The code is located at the Mercurial server <a href="http://wind.calpoly.edu/hg/mecha11">http://wind.calpoly.edu/hg/mecha11</a></p>
<h1><a class="anchor" id="sec_notes"></a>
NOTES</h1>
<p>The controller was hard coded into the task in main. See attached code or mecurial repository for full description of the controller algorithm. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Jun 9 2019 20:37:16 for My Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
