\hypertarget{index_sec_purpose}{}\section{Purpose}\label{index_sec_purpose}
The purpose of this lab is to create a self balancing bike robot named the You\textquotesingle{}re-\/\+Almost-\/\+There. Using a P\+ID control scheme, the balancing bike was able to keep itself upright.\hypertarget{index_sec_usage}{}\section{Usage}\label{index_sec_usage}
The appropriate pins will need to be set up to have the system running properly The pin descriptions are outlined in the classes in the other subsections. The I2C data bus must be enabled and be able to read the digital readings from the B\+N\+O055\+\_\+\+Base driver The following code can be directly copied and pasted into the S\+T\+M32 microcontroller, with motor shield, to run the self balancing mechanism. The battery must be fully charged, and if possible have a 24V DC source for more stability. The bike must initially be as straight as possible since the I\+MU takes the first measurement as the reference point of the balance.\hypertarget{index_sec_test}{}\section{Testing}\label{index_sec_test}
You\textquotesingle{}re-\/\+Almost-\/\+There initially could not balance itself with just a proportional controller. We added in the derivative element into the control scheme, but the system still could not reliably balance. After hours of testing, we were able to find out that the derivative gain had the wrong signage and gave the wrong signals to set the duty cycle of the motor. By correcting the signage, the bike was able to balance even with disturbances. To create a quicker responding system, we added in the integral element into the control scheme as well. To find the correct gains, we set all gain to 0 and adjusted the proportional gain to create a stable oscillation near the balance reference angle. After find the proportional gain, the derivative gain was adjusted to dampen out the oscillation as much as possible. After reaching close to a critically damped response, the integral gain was adjusted to reach steady state even quicker.\hypertarget{index_sec_bug}{}\section{Bugs}\label{index_sec_bug}
Initially, the controller was running at such a high frequency and high priority, that it did not give the other tasks a chance to be run. We wanted to make sure the timing of the controller was at least 5$\sim$10 times faster than the time constant of the motor with the load. We fine tuned the timing frequency and the priority so that all the tasks have a chance to run. We set the ultrasonic sensor task as the highest priority for safety of the user and the bike. The ultrasonic sensor also had very buggy readings where if the readings were taken too quickly, it would pick up noise and return false values. We decided to run the ultrasonic sensor every 0.\+5 seconds so that the readings can be more stable. The I\+MU was also very buggy where the tuple returned from the function would not be stored into a variable. A 0 would be stored everytime, so we were able to mitigate that by not using a intermediate variable in the reading of the I\+MU.\hypertarget{index_sec_lim}{}\section{Limitations}\label{index_sec_lim}
We purposefully did not use a thicker based wheel or counter balancing weight to stabilize our system. We wanted to fully balance the robot by using reaction wheel dynamics. The robot had trouble balancing due to the lack of inertia from the reaction wheel and the torque from the motor. On 24V DC power the robot is stable and can achieve equilibrium, but the voltage rating of the motor is only 12V DC. It is possible to run the motor with 24V DC power source, but the motor heats up due to high current. In the future, a higher rate torque motor can be used to mitigate this problem. The struture of the bike also creates vibration when the reaction wheel reaches around 600 R\+PM. The vibration does not affect the balance immensely, but if the accelerometer readings were very crucial in future applications, the I\+MU would return inaccurate values.\+For our purposes, the system was robust enough to handle minor vibrations. The driving motor, during our rigorous tests had mechanical failure. The gear box within the DC motor experiences slippage and there are times where the gears get jammed. In that case, the motor does not spin. The user needs to firmly tap the backside of motor housing to realign the motors in the gear box. If the motor experiences extensive stress and saturates the duty cycle fluctuating between -\/100 and 100 constantly, there is a chance for the flange coupler to give out. The coupler is set by 4 set screws and can get loose due to the constant impulses of torque.\hypertarget{index_sec_loc}{}\section{Location}\label{index_sec_loc}
The code is located at the Mercurial server \href{http://wind.calpoly.edu/hg/mecha11}{\tt http\+://wind.\+calpoly.\+edu/hg/mecha11}\hypertarget{index_sec_notes}{}\section{N\+O\+T\+ES}\label{index_sec_notes}
The controller was hard coded into the task in main. See attached code or mecurial repository for full description of the controller algorithm. 